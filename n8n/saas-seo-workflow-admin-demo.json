{
  "name": "SaaS SEO Workflow - Full",
  "nodes": [
    {
      "id": "1",
      "name": "Webhook Start",
      "type": "n8n-nodes-base.webhook",
      "position": [
        240,
        300
      ],
      "parameters": {
        "httpMethod": "POST",
        "path": "saas-seo-admin-demo",
        "responseMode": "onReceived"
      }
    },
    {
      "id": "2",
      "name": "Set Variables",
      "type": "n8n-nodes-base.set",
      "position": [
        440,
        300
      ],
      "parameters": {
        "values": {
          "string": [
            {
              "name": "user_id",
              "value": "={{$json.userId}}"
            },
            {
              "name": "projectId",
              "value": "={{$json.projectId}}"
            },
            {
              "name": "planType",
              "value": "={{$json.planType}}"
            },
            {
              "name": "userRole",
              "value": "={{$json.userRole}}"
            },
            {
              "name": "currentStep",
              "value": "={{$json.currentStep}}"
            },
            {
              "name": "projectData",
              "value": "={{$json.projectData}}"
            },
            {
              "name": "userMessage",
              "value": "={{$json.userMessage}}"
            }
          ]
        }
      }
    },
    {
      "id": "3",
      "name": "Switch Step",
      "type": "n8n-nodes-base.switch",
      "position": [
        640,
        300
      ],
      "parameters": {
        "property": "={{$json.currentStep}}",
        "rules": [
          {
            "operation": "equal",
            "value": "1"
          },
          {
            "operation": "equal",
            "value": "2"
          },
          {
            "operation": "equal",
            "value": "3"
          },
          {
            "operation": "equal",
            "value": "4"
          },
          {
            "operation": "equal",
            "value": "5"
          },
          {
            "operation": "equal",
            "value": "6"
          },
          {
            "operation": "equal",
            "value": "7"
          },
          {
            "operation": "equal",
            "value": "8"
          },
          {
            "operation": "equal",
            "value": "9"
          }
        ]
      }
    },
    {
      "id": "4",
      "name": "Fetch Project Data",
      "type": "n8n-nodes-base.supabase",
      "position": [
        840,
        100
      ],
      "parameters": {
        "operation": "select",
        "table": "projects",
        "filters": [
          {
            "column": "id",
            "operator": "equal",
            "value": "={{$json.projectId}}"
          }
        ]
      },
      "credentials": {}
    },
    {
      "id": "5",
      "name": "Fetch Previous Step Result",
      "type": "n8n-nodes-base.supabase",
      "position": [
        840,
        200
      ],
      "parameters": {
        "operation": "select",
        "table": "step_results",
        "filters": [
          {
            "column": "project_id",
            "operator": "equal",
            "value": "={{$json.projectId}}"
          },
          {
            "column": "step_number",
            "operator": "equal",
            "value": "={{$json.currentStep - 1}}"
          }
        ],
        "limit": 1,
        "order": [
          {
            "column": "created_at",
            "direction": "desc"
          }
        ]
      },
      "credentials": {}
    },
    {
      "id": "6",
      "name": "Prepare LLM Prompt",
      "type": "n8n-nodes-base.code",
      "position": [
        1040,
        100
      ],
      "parameters": {
        "language": "javascript",
        "functionCode": "return [{ json: { prompt: \"Generate content for step \" + $json.currentStep + \" based on project data: \" + JSON.stringify($json.projectData) + \" and previous step result: \" + JSON.stringify($json.previousStepResult) } }];"
      }
    },
    {
      "id": "7",
      "name": "Call LLM",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        1240,
        100
      ],
      "parameters": {
        "url": "https://api.groq.com/openai/v1/chat/completions",
        "method": "POST",
        "responseFormat": "json",
        "jsonParameters": true,
        "body": {
          "model": "llama-3.1-8b-instant",
          "messages": [
            {
              "role": "system",
              "content": "You are an AI assistant for SEO content generation. Generate content based on the user's request and project data."
            },
            {
              "role": "user",
              "content": "={{$json.prompt}}"
            }
          ]
        }
      }
    },
    {
      "id": "8",
      "name": "Process LLM Output",
      "type": "n8n-nodes-base.code",
      "position": [
        1440,
        100
      ],
      "parameters": {
        "language": "javascript",
        "functionCode": "return [{ json: { llm_output: $json.choices[0].message.content } }];"
      }
    },
    {
      "id": "9",
      "name": "Insert Step Result",
      "type": "n8n-nodes-base.supabase",
      "position": [
        1640,
        100
      ],
      "parameters": {
        "operation": "insert",
        "table": "step_results",
        "columns": [
          "project_id",
          "step_number",
          "step_name",
          "llm_output",
          "approved"
        ],
        "values": [
          "={{$json.projectId}}",
          "={{$json.currentStep}}",
          "Step {{$json.currentStep}} Content",
          "={{$json.llm_output}}",
          "={{$json.currentStep === 1 ? true : false}}"
        ]
      },
      "credentials": {}
    },
    {
      "id": "10",
      "name": "Update Project Step",
      "type": "n8n-nodes-base.supabase",
      "position": [
        1840,
        100
      ],
      "parameters": {
        "operation": "update",
        "table": "projects",
        "filters": [
          {
            "column": "id",
            "operator": "equal",
            "value": "={{$json.projectId}}"
          }
        ],
        "updateColumns": [
          "current_step"
        ],
        "updateValues": [
          "={{$json.currentStep}}"
        ]
      },
      "credentials": {}
    },
    {
      "id": "11",
      "name": "Call Frontend Trigger",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        2040,
        100
      ],
      "parameters": {
        "url": "={{$env.SUPABASE_URL}}/functions/v1/trigger-step",
        "method": "POST",
        "jsonParameters": true,
        "body": {
          "projectId": "={{$json.projectId}}"
        }
      },
      "credentials": {}
    },
    {
      "id": "99",
      "name": "Finalize Response",
      "type": "n8n-nodes-base.code",
      "position": [
        2240,
        300
      ],
      "parameters": {
        "language": "javascript",
        "functionCode": "return [{ json: { message: \"Admin demo workflow completed.\" } }];"
      }
    }
  ],
  "connections": {
    "Webhook Start": {
      "main": [
        [
          "2"
        ]
      ]
    },
    "Set Variables": {
      "main": [
        [
          "3"
        ]
      ]
    },
    "Switch Step": {
      "main": [
        [
          "4",
          "5"
        ],
        [
          "4",
          "5"
        ],
        [
          "4",
          "5"
        ],
        [
          "4",
          "5"
        ],
        [
          "4",
          "5"
        ],
        [
          "4",
          "5"
        ],
        [
          "4",
          "5"
        ],
        [
          "4",
          "5"
        ],
        [
          "4",
          "5"
        ]
      ]
    },
    "Fetch Project Data": {
      "main": [
        [
          "6"
        ]
      ]
    },
    "Fetch Previous Step Result": {
      "main": [
        [
          "6"
        ]
      ]
    },
    "Prepare LLM Prompt": {
      "main": [
        [
          "7"
        ]
      ]
    },
    "Call LLM": {
      "main": [
        [
          "8"
        ]
      ]
    },
    "Process LLM Output": {
      "main": [
        [
          "9"
        ]
      ]
    },
    "Insert Step Result": {
      "main": [
        [
          "10"
        ]
      ]
    },
    "Update Project Step": {
      "main": [
        [
          "11"
        ]
      ]
    },
    "Call Frontend Trigger": {
      "main": [
        [
          "99"
        ]
      ]
    }
  }
}